<section class="flex flex-row p-3">
  <button type="button" class="ml-auto ps-2 flex flex-wrap items-center text-base justify-center" data-modal-target="new-member-modal" data-modal-toggle="new-member-modal">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="w-6 h-6 fill-blue-500">
      <path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM504 312l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/>
    </svg>
  </button>
</section>

<section class="overflow-x-auto shadow-md sm:rounded-lg">
  <table class="w-full text-sm text-left rtl:text-right text-gray-500">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
      <tr>
        <th scope="col" class="p-4">
          <!-- チェックボックスの列を確保 -->
        </th>
        <th scope="col" class="px-2 py-3">
          Number
        </th>
        <th scope="col" class="px-3 py-3">
          Name
        </th>
        <th scope="col" class="px-2 py-3">
          Permission
        </th>
        <th scope="col" class="px-2 py-3">
          Edit
        </th>
      </tr>
    </thead>
    <tbody id="member_list_table"></tbody>
  </table>
</section>

<div id="new-member-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow-sm">
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">
                    部員新規登録
                </h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="new-member-modal">
                    <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <section class="p-4 md:p-5">
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-2">
                        <label for="new-member-number" class="block mb-2 text-sm font-medium text-gray-900">
                          学籍番号
                        </label>
                        <input type="number" name="new-member-number" id="new-member-number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="4桁の学籍番号を入力" min="1101" max="3850" required />
                    </div>
                    <div class="col-span-2">
                        <label for="new-member-identification-number" class="block mb-2 text-sm font-medium text-gray-900">
                          固有学籍番号
                        </label>
                        <input type="number" id="new-member-identification-number" class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="6桁の学籍番号(例.220101)を入力" min="999999" required />
                    </div>
                    <div class="col-span-2">
                        <label for="new-member-name" class="block mb-2 text-sm font-medium text-gray-900">
                          氏名
                        </label>
                        <input type="text" name="new-member-name" id="new-member-name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="氏名を入力(姓と名は半角数字で空ける)" required />
                    </div>
                    <div class="col-span-2">
                        <label for="new-member-permission" class="block mb-2 text-sm font-medium text-gray-900">
                          権限
                        </label>
                        <select id="new-member-permission" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                            <option selected="">権限を選択</option>
                            <option value="normal">normal(デフォルト)</option>
                            <option value="teacher">teacher(顧問)</option>
                            <option value="admin">admin(本アプリの管理者権限)</option>
                        </select>
                    </div>
                </div>
                <button onclick="sendNewMember()" id="send-new-member-button" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    送信
                </button>
            </section>
        </div>
    </div>
</div>

<script>
  function set_member_list(member_list) {
      if(member_list.status !== "200 ok") {
          openModal("status_modal", arguments.callee.name, "error", member_list.status);
          return;
      } else {
          try {
              const member_list_table_element = document.getElementById("member_list_table");
              member_list_table_element.innerHTML = "";

              for(let i = 0; i < member_list.member.length; i++) {
                  const tr_element = document.createElement("tr");
                  tr_element.setAttribute("class", "bg-white border-b border-gray-200 hover:bg-gray-50")
                  
                  const td_element = document.createElement("td");
                  td_element.setAttribute("class", "w-4 p-4");

                  const div_element = document.createElement("div");
                  div_element.setAttribute("class", "flex items-center");

                  const input_element = document.createElement("input");
                  input_element.setAttribute("class", "w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 focus:ring-2");
                  input_element.setAttribute("type", "checkbox");
                  input_element.setAttribute("id", "checkbox-table-search-1");
                  div_element.appendChild(input_element);

                  const label_element = document.createElement("label");
                  label_element.setAttribute("for", "checkbox-table-search-1");
                  label_element.setAttribute("class", "sr-only");
                  label_element.textContent = "checkbox"
                  div_element.appendChild(label_element);

                  td_element.appendChild(div_element);
                  tr_element.appendChild(td_element);

                  const th_element = document.createElement("th");
                  th_element.setAttribute("scope", "row");
                  th_element.setAttribute("class", "items-center px-4 py-4 text-gray-900 whitespace-nowrap");

                  const td_number_element = document.createElement("td");
                  td_number_element.textContent = member_list.member[i][0];
                  td_number_element.setAttribute("class", "px-2 py-4");
                  tr_element.appendChild(td_number_element);
                  
                  const div_wrap_name_and_email_element = document.createElement("div");

                  const div_name_element = document.createElement("div");
                  div_name_element.textContent = member_list.member[i][3];
                  div_name_element.setAttribute("class", "text-sm md:text-base font-semibold");
                  div_wrap_name_and_email_element.appendChild(div_name_element);

                  const div_email_element = document.createElement("div");
                  div_email_element.textContent = member_list.member[i][4];
                  div_email_element.setAttribute("class", "font-normal text-gray-500");
                  div_wrap_name_and_email_element.appendChild(div_email_element);

                  th_element.appendChild(div_wrap_name_and_email_element);
                  tr_element.appendChild(th_element);

                  const td_permission_element = document.createElement("td");
                  td_permission_element.textContent = member_list.member[i][2];
                  td_permission_element.setAttribute("class", "px-2 py-4");
                  tr_element.appendChild(td_permission_element);

                  const td_wrap_edit_element = document.createElement("td");
                  td_wrap_edit_element.setAttribute("class", "px-2 py-4")

                  const i_user_edit_element = document.createElement("i");
                  i_user_edit_element.setAttribute("class", "fa-solid fa-user-pen");
                  i_user_edit_element.setAttribute("onclick", `memberInfoUpdate("${member_list.member[i][1]}")`);
                  i_user_edit_element.setAttribute("style", "color: var(--color-blue-500);");
                  td_wrap_edit_element.appendChild(i_user_edit_element);
                  tr_element.appendChild(td_wrap_edit_element);

                  member_list_table_element.appendChild(tr_element);
              };
          } catch(e) {
              openModal("status_modal", arguments.callee.name, "error", e.message);
          }
      }
  }

  function sendNewMember() {
      try {
          document.getElementById("send-new-member-button").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
          const [
              new_member_number,
              new_member_identification_number,
              new_member_permission,
              new_member_name,
              new_member_email
          ] = [
              String(document.getElementById("new-member-number").value),
              String(document.getElementById("new-member-identification-number").value),
              String(document.getElementById("new-member-permission").value),
              String(document.getElementById("new-member-name").value),
              String(document.getElementById("new-member-identification-number").value + "@oks.city-saitama.ed.jp")
          ];
          google.script.run.withSuccessHandler(function() {
              document.getElementById("new-member-number").value = "";
              document.getElementById("new-member-identification-number").value = "";
              document.getElementById("new-member-permission").value = "";
              document.getElementById("new-member-name").value = "";
              document.getElementById("new-member-identification-number").value = "";
              closeModal("new-member-modal");
              openModal("status_modal", "新規部員登録", "success");
          }).sendData(
              "add_member_list",
              new_member_number,
              new_member_identification_number,
              new_member_permission,
              new_member_name,
              new_member_email
          );
      } catch(e) {
          openModal("status_modal", arguments.callee.name, "error", e.message);
      }
  }

  function memberInfoUpdate(user_origin_number) {
      console.log(user_origin_number)
  }
</script>