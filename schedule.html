<section class="flex flex-row p-3">
  <button type="button" class="ml-auto ps-2 flex flex-wrap items-center text-base justify-center" data-modal-target="new-schedule-modal" data-modal-toggle="new-schedule-modal">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="w-6 h-6 fill-blue-500">
      <path d="M96 32l0 32L48 64C21.5 64 0 85.5 0 112l0 48 448 0 0-48c0-26.5-21.5-48-48-48l-48 0 0-32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 32L160 64l0-32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192L0 192 0 464c0 26.5 21.5 48 48 48l352 0c26.5 0 48-21.5 48-48l0-272zM224 248c13.3 0 24 10.7 24 24l0 56 56 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-56 0 0 56c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-56-56 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l56 0 0-56c0-13.3 10.7-24 24-24z"/>
    </svg>
  </button>
</section>

<section id="schedule_list_card"></section>

<div id="new-schedule-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow-sm">
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">
                    部活動スケジュール新規作成
                </h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="new-schedule-modal">
                    <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <section class="p-4 md:p-5">
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-2">
                        <label for="title" class="block mb-2 text-sm font-medium text-gray-900">
                          タイトル
                        </label>
                        <input type="text" name="title" id="title" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="活動内容を簡潔に入力" required />
                    </div>
                    <div class="col-span-2">
                        <label for="default-datepicker" class="block mb-2 text-sm font-medium text-gray-900">
                          日付を選択
                        </label>
                        <input type="date" name="date" id="default-datepicker" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="日付を選択" required />
                    </div>
                    <div class="col-span-1">
                        <label for="start-time" class="block mb-2 text-sm font-medium text-gray-900">
                          開始時刻
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <input type="time" id="start-time" class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" value="00:00" required />
                        </div>
                    </div>
                    <div class="col-span-1">
                        <label for="end-time" class="block mb-2 text-sm font-medium text-gray-900">
                          終了時刻
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <input type="time" id="end-time" class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" value="00:00" required />
                        </div>
                    </div>
                    <div class="col-span-2">
                        <label for="memo" class="block mb-2 text-sm font-medium text-gray-900">
                          備考
                        </label>
                        <textarea id="memo" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="活動の詳細などを入力"></textarea>                    
                    </div>
                </div>
                <button onclick="sendNewSchedule()" id="send-new-schedule-button" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    スケジュールを追加
                </button>
            </section>
        </div>
    </div>
</div>

<button type="button" class="hidden" data-modal-target="schedule-detail-modal" data-modal-toggle="schedule-detail-modal"></button>

<button type="button" class="hidden" data-modal-target="schedule-absence-modal" data-modal-toggle="schedule-absence-modal"></button>

<div id="schedule-detail-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow-sm">
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">
                    部活動スケジュール詳細
                </h3>
                <h5 class="hidden" id="detail-id"></h5>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="schedule-detail-modal">
                    <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <section class="p-4 md:p-5">
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-2">
                        <label for="detail-absence-list" class="block mb-2 text-sm font-medium text-gray-900">
                          欠席申請一覧
                        </label>
                        <div id="detail-absence-list" class="bg-red-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></div>
                    </div>
                    <div class="col-span-2">
                        <label for="detail-title" class="block mb-2 text-sm font-medium text-gray-900">
                          タイトル
                        </label>
                        <input type="text" name="detail-title" id="detail-title" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="活動内容を簡潔に入力" required />
                    </div>
                    <div class="col-span-2">
                        <label for="default-datepicker" class="block mb-2 text-sm font-medium text-gray-900">
                          日付を選択
                        </label>
                        <input type="date" name="date" id="default-datepicker" class="detail-date bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="日付を選択" required />
                    </div>
                    <div class="col-span-1">
                        <label for="detail-start-time" class="block mb-2 text-sm font-medium text-gray-900">
                          開始時刻
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <input type="time" id="detail-start-time" class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" value="00:00" required />
                        </div>
                    </div>
                    <div class="col-span-1">
                        <label for="detail-end-time" class="block mb-2 text-sm font-medium text-gray-900">
                          終了時刻
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <input type="time" id="detail-end-time" class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" value="00:00" required />
                        </div>
                    </div>
                    <div class="col-span-2">
                        <label for="detail-memo" class="block mb-2 text-sm font-medium text-gray-900">
                          備考
                        </label>
                        <textarea id="detail-memo" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="活動の詳細などを入力"></textarea>                    
                    </div>
                </div>
                <button id="schedule-update-button" onclick="sendScheduleUpdate()" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    スケジュールを変更
                </button>
            </section>
        </div>
    </div>
</div>

<div id="schedule-absence-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow-sm">
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">
                    欠席・早退・遅刻申請
                </h3>
                <h5 class="hidden" id="absence-schedule-id"></h5>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="schedule-absence-modal">
                    <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <section class="p-4 md:p-5">
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-2">
                        <label for="absence-all" class="block mb-2 text-sm font-medium text-gray-900">
                          欠席申請一覧
                        </label>
                        <div id="absence-all" class="bg-red-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></div>
                    </div>
                    <div class="col-span-2">
                        <label for="absence-kind" class="block mb-2 text-sm font-medium text-gray-900">
                          区分
                        </label>
                        <select id="absence-kind" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                            <option value="">区分を選択</option>
                            <option value="欠席">欠席</option>
                            <option value="早退">早退</option>
                            <option value="遅刻">遅刻</option>
                        </select>
                    </div>
                    <div class="col-span-2">
                        <label for="absence-reason" class="block mb-2 text-sm font-medium text-gray-900">
                          申請理由
                        </label>
                        <textarea id="absence-reason" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="申請の理由を入力"></textarea>                    
                    </div>
                </div>
                <button id="send-absence-button" onclick="sendAbsence()" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    申請送信
                </button>
                <hr class="h-px my-5 bg-gray-200 border-0 dark:bg-gray-700" />
                <div class="col-span-2">
                    <label for="absence-delete-button" class="block mb-2 text-sm font-medium text-gray-900">
                      申請済みの情報を削除
                    </label>
                    <button onclick="deleteAbsence()" id="absence-delete-button" class="w-full text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                        この日程に対する申請を削除します(即時実行)
                    </button>                    
                </div>
            </section>
        </div>
    </div>
</div>

<script>
  function setScheduleList(schedule_list) {
      if(schedule_list.status !== "200 ok") {
          openModal("status-modal", arguments.callee.name, "error", schedule_list.status);
          return;
      } else if(schedule_list.schedule.length === 0){
          const schedule_list_card_element = document.getElementById("schedule_list_card");
          const div_none_schedule_msg = document.createElement("div");
          div_none_schedule_msg.setAttribute("class", "container px-5 mx-auto sm:text-3xl text-2xl font-medium mb-4 text-gray-900");
          div_none_schedule_msg.textContent = "登録されている予定はありません。";
          schedule_list_card_element.appendChild(div_none_schedule_msg);
          return;
      } else {
          try {
              const schedule_list_card_element = document.getElementById("schedule_list_card");
              for(let i = 0; i < schedule_list.schedule.length; i++) {
                  const div_all_wrap_element = document.createElement("div");
                  div_all_wrap_element.setAttribute("class", "whitespace-nowrap w-5/6 mx-auto bg-white rounded-xl shadow-md overflow-hidden sm:max-w-2xl m-3");

                  const div_element = document.createElement("div");
                  div_element.setAttribute("class", "flex flex-col sm:flex-row sm:items-center p-8");

                  const section_wrap_title_time_element = document.createElement("section");
                  
                  const div_date_element = document.createElement("div");
                  div_date_element.textContent = schedule_list.schedule[i][1].replaceAll("-", "/");
                  div_date_element.setAttribute("class", "uppercase tracking-wide text-sm text-indigo-500 font-semibold")
                  section_wrap_title_time_element.appendChild(div_date_element);

                  const p_title_element = document.createElement("p");
                  p_title_element.textContent = schedule_list.schedule[i][2] + " " + schedule_list.schedule[i][3]
                  p_title_element.setAttribute("class", "block mt-1 text-lg leading-tight font-medium text-black");
                  section_wrap_title_time_element.appendChild(p_title_element);

                  const p_made_user_element = document.createElement("p");
                  p_made_user_element.textContent = "作成: " + schedule_list.schedule[i][5];
                  p_made_user_element.setAttribute("class", "my-2 sm:my-0 text-gray-500 text-sm");
                  section_wrap_title_time_element.appendChild(p_made_user_element);

                  div_element.appendChild(section_wrap_title_time_element);

                  const section_wrap_buttons_element = document.createElement("section");
                  section_wrap_buttons_element.setAttribute("class", "my-1 sm:ml-auto flex flex-wrap items-center text-base sm:justify-center")

                  const button_detail_element = document.createElement("button");
                  button_detail_element.textContent = "詳細";
                  button_detail_element.setAttribute("type", "button");
                  button_detail_element.setAttribute("id", `detail-button-${schedule_list.schedule[i][0]}`);
                  button_detail_element.setAttribute("onclick", `callScheduleDetail('${schedule_list.schedule[i][0]}')`);
                  button_detail_element.setAttribute("class", "text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center");
                  section_wrap_buttons_element.appendChild(button_detail_element);

                  const button_absence_button = document.createElement("button");
                  button_absence_button.textContent = "欠席連絡";
                  button_absence_button.setAttribute("type", "button");
                  button_absence_button.setAttribute("id", `absence-button-${schedule_list.schedule[i][0]}`);
                  button_absence_button.setAttribute("onclick", `callScheduleAbsence('${schedule_list.schedule[i][0]}')`);
                  button_absence_button.setAttribute("class", "text-white inline-flex items-center bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm ml-2 px-5 py-2.5 text-center");
                  section_wrap_buttons_element.appendChild(button_absence_button);

                  div_element.appendChild(section_wrap_buttons_element);
                  div_all_wrap_element.appendChild(div_element);
                  schedule_list_card_element.appendChild(div_all_wrap_element);
              };
          } catch(e) {
              openModal("status-modal", arguments.callee.name, "error", e.message);
          }
      }
  }

  function callScheduleDetail(schedule_id) {
      document.getElementById(`detail-button-${schedule_id}`).innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      google.script.run.withSuccessHandler(showScheduleDetail).getData("schedule_detail_from_id", schedule_id);
  }

  function callScheduleAbsence(schedule_id) {
      document.getElementById(`absence-button-${schedule_id}`).innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      google.script.run.withSuccessHandler(showScheduleAbsenceForm).getData("schedule_detail_from_id", schedule_id);
  }

  function showScheduleDetail(detail_list) {
      if(detail_list.status !== "200 ok") {
          openModal("status-modal", arguments.callee.name, "error", detail_list.status);
          return;
      } else {
          try {
              document.getElementById("detail-id").value = "";
              document.getElementById("detail-title").value = "";
              document.querySelector(".detail-date").value = "";
              document.getElementById("detail-start-time").value = "00:00";
              document.getElementById("detail-end-time").value = "00:00";
              document.getElementById("detail-memo").value = "";
              document.getElementById("detail-absence-list").innerHTML = "";

              openModal("schedule-detail-modal");
              document.getElementById("detail-id").value = detail_list.schedule_detail[0];
              document.getElementById("detail-title").value = detail_list.schedule_detail[2];
              document.querySelector(".detail-date").value = detail_list.schedule_detail[1].replaceAll("/", "-");
              document.getElementById("detail-start-time").value = detail_list.schedule_detail[3].split("~")[0];
              document.getElementById("detail-end-time").value = detail_list.schedule_detail[3].split("~")[1];
              document.getElementById("detail-memo").value = detail_list.schedule_detail[4];

              const div_absence_list_element = document.getElementById("detail-absence-list");
              const absence_list = detail_list.schedule_detail[6];

              if(absence_list.length === 0) {
                  div_absence_list_element.innerHTML = "現在申請はありません。"
              } else {
                  for(let i = 0; i < absence_list.length; i++) {
                      const div_wrap_absence_element = document.createElement("div");
                      div_wrap_absence_element.setAttribute("class", "py-2");

                      const p_absence_kind_name_element = document.createElement("div");
                      p_absence_kind_name_element
                      const p_absence_reason_element = document.createElement("div");
                      p_absence_kind_name_element.textContent = absence_list[i][2] + ": " + absence_list[i][1];
                      p_absence_reason_element.textContent = "理由: " + absence_list[i][3];

                      div_wrap_absence_element.appendChild(p_absence_kind_name_element);
                      div_wrap_absence_element.appendChild(p_absence_reason_element);
                      div_absence_list_element.appendChild(div_wrap_absence_element);
                  }
              };
              document.getElementById(`detail-button-${detail_list.schedule_detail[0]}`).innerHTML = "";
              document.getElementById(`detail-button-${detail_list.schedule_detail[0]}`).textContent = "詳細";
          } catch(e) {
              closeModal("schedule-detail-modal");
              openModal("status-modal", arguments.callee.name, "error", e.message);
          }
      }
  }

  function showScheduleAbsenceForm(detail_list) {
      if(detail_list.status !== "200 ok") {
          openModal("status-modal", arguments.callee.name, "error", detail_list.status);
          return;
      } else {
          try {
              document.getElementById("absence-schedule-id").value = "";
              document.getElementById("absence-all").value = "";
              document.getElementById("absence-kind").value = "";
              document.getElementById("absence-reason").innerHTML = "";
              openModal("schedule-absence-modal");

              document.getElementById("absence-schedule-id").value = detail_list.schedule_detail[0];
              const div_absence_list_element = document.getElementById("absence-all");
              const absence_list = detail_list.schedule_detail[6];

              if(absence_list.length === 0) {
                  div_absence_list_element.innerHTML = "現在申請はありません。"
              } else {
                  for(let i = 0; i < absence_list.length; i++) {
                      const div_wrap_absence_element = document.createElement("div");
                      div_wrap_absence_element.setAttribute("class", "py-2");

                      const p_absence_kind_name_element = document.createElement("div");
                      p_absence_kind_name_element
                      const p_absence_reason_element = document.createElement("div");
                      p_absence_kind_name_element.textContent = absence_list[i][1] + ": " + absence_list[i][0];
                      p_absence_reason_element.textContent = "理由: " + absence_list[i][2];

                      div_wrap_absence_element.appendChild(p_absence_kind_name_element);
                      div_wrap_absence_element.appendChild(p_absence_reason_element);
                      div_absence_list_element.appendChild(div_wrap_absence_element);
                  }
              };
              document.getElementById(`absence-button-${detail_list.schedule_detail[0]}`).innerHTML = "";
              document.getElementById(`absence-button-${detail_list.schedule_detail[0]}`).textContent = "欠席連絡";
          } catch(e) {
              closeModal("schedule-absence-modal");
              openModal("status-modal", arguments.callee.name, "error", e.message);
          }
      }
  }

  function sendNewSchedule() {
    try {
        document.getElementById("send-new-schedule-button").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        const [
            new_schedule_date,
            new_schedule_title,
            new_schedule_start_time,
            new_schedule_end_time,
            new_schedule_memo
        ] = [
            String(document.getElementById("default-datepicker").value),
            String(document.getElementById("title").value),
            String(document.getElementById("start-time").value),
            String(document.getElementById("end-time").value),
            String(document.getElementById("memo").value)
        ];
        google.script.run.withSuccessHandler(function() {
            document.getElementById("default-datepicker").value = "";
            document.getElementById("title").value= "";
            document.getElementById("start-time").value= "";
            document.getElementById("end-time").value= "";
            document.getElementById("memo").value= "";
            document.getElementById("send-new-schedule-button").textContent = "スケジュールを追加";
            closeModal("new-schedule-modal");
            openModal("status-modal", "新規スケジュール追加", "success");
        }).sendData(
            "add_schedule",
            new_schedule_date,
            new_schedule_title,
            new_schedule_start_time,
            new_schedule_end_time,
            new_schedule_memo
        );
    } catch(e) {
        openModal("status-modal", arguments.callee.name, "error" + e.message);
    }
  }

  function sendScheduleUpdate() {
    try {
        document.getElementById("schedule-update-button").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        const [
            schedule_id,
            update_schedule_date,
            update_schedule_title,
            update_schedule_start_time,
            update_schedule_end_time,
            update_schedule_memo
        ] = [
            String(document.getElementById("detail-id").value),
            String(document.querySelector(".detail-date").value),
            String(document.getElementById("detail-title").value),
            String(document.getElementById("detail-start-time").value),
            String(document.getElementById("detail-end-time").value),
            String(document.getElementById("detail-memo").value)
        ];
        google.script.run.withSuccessHandler(function() {
            document.getElementById("detail-id").value = "";
            document.getElementById("detail-title").value = "";
            document.querySelector(".detail-date").value = "";
            document.getElementById("detail-start-time").value = "";
            document.getElementById("detail-end-time").value = "";
            document.getElementById("detail-memo").value = "";
            document.getElementById("detail-absence-list").value = "";
            closeModal("schedule-detail-modal");
            openModal("status-modal", "既存スケジュール変更", "success");
            document.getElementById("schedule-update-button").innerHTML = "スケジュールを変更";
        }).sendData(
            "schedule_update",
            schedule_id,
            update_schedule_date,
            update_schedule_title,
            update_schedule_start_time,
            update_schedule_end_time,
            update_schedule_memo
        );
    } catch(e) {
        openModal("status-modal", arguments.callee.name, "error" +  e.message);
    }
  }

  function sendAbsence() {
    try {
        document.getElementById("send-absence-button").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        const [
            schedule_id,
            absence_kind,
            absence_reason
        ] = [
            String(document.getElementById("absence-schedule-id").value),
            String(document.getElementById("absence-kind").value),
            String(document.getElementById("absence-reason").value),
        ];
        google.script.run.withSuccessHandler(function() {
            document.getElementById("absence-schedule-id").value = "";
            document.getElementById("absence-all").innerHTML = "";
            document.getElementById("absence-kind").value = "";
            document.getElementById("absence-reason").value = "";
            document.getElementById("send-absence-button").innerHTML = "申請送信";
            closeModal("schedule-absence-modal");
            openModal("status-modal", "新規欠席申請", "success");
        }).sendData(
            "add_new_absence",
            schedule_id,
            absence_kind,
            absence_reason
        );
    } catch(e) {
        openModal("status-modal", arguments.callee.name, "error" + e.message);
    }
  }

  function deleteAbsence() {
    try {
        document.getElementById("absence-delete-button").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        google.script.run.withSuccessHandler(function() {
            document.getElementById("absence-schedule-id").value = "";
            document.getElementById("absence-all").innerHTML = "";
            document.getElementById("absence-kind").value = "";
            document.getElementById("absence-reason").value = "";
            document.getElementById("absence-delete-button").innerHTML = "この日程に対する申請を削除します(即時実行)";
            closeModal("schedule-absence-modal");
            openModal("status-modal", "欠席申請取り消し", "success");
        }).sendData(
            "delete_absence",
            document.getElementById("absence-schedule-id").value
        );
    } catch(e) {
        openModal("status-modal", arguments.callee.name, "error" + e.message);
    }
  }
</script>
